<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HDTree: hdtree::Branch&lt; AtomicType, std::enable_if_t&lt; is_atomic_v&lt; AtomicType &gt; &gt; &gt;::WriteBuffer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HDTree
   </div>
   <div id="projectbrief">HDTree C++ API</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_5a2fe11bd01ac5a6f295b79c630e093e.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">hdtree::Branch&lt; AtomicType, std::enable_if_t&lt; is_atomic_v&lt; AtomicType &gt; &gt; &gt;::WriteBuffer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for hdtree::Branch&lt; AtomicType, std::enable_if_t&lt; is_atomic_v&lt; AtomicType &gt; &gt; &gt;::WriteBuffer:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_d36e8d366134676a73c91b55ce89dcd9.svg" width="236" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a40909700ec84d4ba4898d343879b7fba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#a40909700ec84d4ba4898d343879b7fba">WriteBuffer</a> (std::size_t max, HighFive::DataSet s)</td></tr>
<tr class="memdesc:a40909700ec84d4ba4898d343879b7fba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define the buffer size and the set we will write to.  <a href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#a40909700ec84d4ba4898d343879b7fba">More...</a><br /></td></tr>
<tr class="separator:a40909700ec84d4ba4898d343879b7fba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2df5fea92bc37df50f923145fdb9368e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#a2df5fea92bc37df50f923145fdb9368e">save</a> (const AtomicType &amp;val)</td></tr>
<tr class="memdesc:a2df5fea92bc37df50f923145fdb9368e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put the new value into the buffer.  <a href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#a2df5fea92bc37df50f923145fdb9368e">More...</a><br /></td></tr>
<tr class="separator:a2df5fea92bc37df50f923145fdb9368e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aef81c9cc1772da51f0f453390193a8fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#aef81c9cc1772da51f0f453390193a8fd">flush</a> ()</td></tr>
<tr class="memdesc:aef81c9cc1772da51f0f453390193a8fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush our in-memory buffer onto disk.  <a href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html#aef81c9cc1772da51f0f453390193a8fd">More...</a><br /></td></tr>
<tr class="separator:aef81c9cc1772da51f0f453390193a8fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a4b78579657bc260b4e5a99561d837a17"><td class="memItemLeft" align="right" valign="top"><a id="a4b78579657bc260b4e5a99561d837a17"></a>
std::size_t&#160;</td><td class="memItemRight" valign="bottom"><b>max_len_</b></td></tr>
<tr class="separator:a4b78579657bc260b4e5a99561d837a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a107767724a223ca92d8618a6c8b6cc6d"><td class="memItemLeft" align="right" valign="top"><a id="a107767724a223ca92d8618a6c8b6cc6d"></a>
HighFive::DataSet&#160;</td><td class="memItemRight" valign="bottom"><b>set_</b></td></tr>
<tr class="separator:a107767724a223ca92d8618a6c8b6cc6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23b20611a9ff0b6652890a142d896061"><td class="memItemLeft" align="right" valign="top"><a id="a23b20611a9ff0b6652890a142d896061"></a>
std::vector&lt; AtomicType &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>buffer_</b></td></tr>
<tr class="separator:a23b20611a9ff0b6652890a142d896061"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad233e9e5375188fd3d96dc942b9ba636"><td class="memItemLeft" align="right" valign="top"><a id="ad233e9e5375188fd3d96dc942b9ba636"></a>
std::size_t&#160;</td><td class="memItemRight" valign="bottom"><b>i_file_</b></td></tr>
<tr class="separator:ad233e9e5375188fd3d96dc942b9ba636"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a40909700ec84d4ba4898d343879b7fba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40909700ec84d4ba4898d343879b7fba">&#9670;&nbsp;</a></span>WriteBuffer()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename AtomicType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classhdtree_1_1Branch.html">hdtree::Branch</a>&lt; AtomicType, std::enable_if_t&lt; <a class="el" href="namespacehdtree.html#abc2610fb76593b1d6a9c4106532df50c">is_atomic_v</a>&lt; AtomicType &gt; &gt; &gt;::WriteBuffer::WriteBuffer </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HighFive::DataSet&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Define the buffer size and the set we will write to. </p>
<p>We also use std::vector::reserve to let the memory handler know the size of our buffer. This can help us avoid unnecessary copying and reallocation while using std::vector::push_back to insert elements into the vector.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">max</td><td>buffer size </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>dataset to write to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aef81c9cc1772da51f0f453390193a8fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef81c9cc1772da51f0f453390193a8fd">&#9670;&nbsp;</a></span>flush()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename AtomicType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classhdtree_1_1Branch.html">hdtree::Branch</a>&lt; AtomicType, std::enable_if_t&lt; <a class="el" href="namespacehdtree.html#abc2610fb76593b1d6a9c4106532df50c">is_atomic_v</a>&lt; AtomicType &gt; &gt; &gt;::WriteBuffer::flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flush our in-memory buffer onto disk. </p>
<p>We leave early if the buffer is empty. This is helpful for the case where the number of elements in the dataset happen to be an exact multiple of the buffer size. Then the buffer would be empty at the time that <a class="el" href="classhdtree_1_1Writer.html#a89e4311124e4f23862912f2d059132ac" title="Close up our file, making sure to flush contents to disk.">Writer::~Writer</a> is called which calls all Buffers to flush in order to avoid data loss.</p>
<p>We determine the new extent of the dataset given how many elements are in the buffer, then we resize the dataset that is on disk to this new extent.</p>
<p>Then, we copy the buffer into the DataSet on disk using a compile-time choice that handles the std::vector&lt;bool&gt; specialization <a href="https://github.com/BlueBrain/HighFive/issues/490">bug in HighFive</a>. <em>and</em> translates bools into our custom enum <a class="el" href="namespacehdtree.html#af9d90f959db429ac7ca716e46a099c63" title="Boolean enum aligned with h5py.">hdtree::Bool</a> which mimics the serialization behavior of the bool type understandable by h5py.</p>
<p>Finally, we update the file index, clear the buffer, and re-reserve the maximum length of the buffer to prepare for another chunk of data.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">HighFive::DataSetException</td><td>if unable to extend or write to the DataSet. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2df5fea92bc37df50f923145fdb9368e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2df5fea92bc37df50f923145fdb9368e">&#9670;&nbsp;</a></span>save()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename AtomicType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classhdtree_1_1Branch.html">hdtree::Branch</a>&lt; AtomicType, std::enable_if_t&lt; <a class="el" href="namespacehdtree.html#abc2610fb76593b1d6a9c4106532df50c">is_atomic_v</a>&lt; AtomicType &gt; &gt; &gt;::WriteBuffer::save </td>
          <td>(</td>
          <td class="paramtype">const AtomicType &amp;&#160;</td>
          <td class="paramname"><em>val</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Put the new value into the buffer. </p>
<p>If the buffer goes over the maximum length of the buffer, then we call Buffer::flush</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">val</td><td>data to append to the dataset </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>cpp/include/hdtree/branch/<a class="el" href="AtomicBranch_8h_source.html">AtomicBranch.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacehdtree.html">hdtree</a></li><li class="navelem"><a class="el" href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4.html">Branch&lt; AtomicType, std::enable_if_t&lt; is_atomic_v&lt; AtomicType &gt; &gt; &gt;</a></li><li class="navelem"><a class="el" href="classhdtree_1_1Branch_3_01AtomicType_00_01std_1_1enable__if__t_3_01is__atomic__v_3_01AtomicType_01_4_01_4_01_4_1_1WriteBuffer.html">WriteBuffer</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
